# NAMS 매칭 시스템 구현 계획

> **작성일**: 2025-12-16
> **기준 PRD**: [PRD-NAMS-MATCHING.md](PRD-NAMS-MATCHING.md)

---

## 현재 상태 분석

### 데이터 현황

```
┌─────────────────────────────────────────────────────────┐
│                    현재 상태                             │
├─────────────────────────────────────────────────────────┤
│  NAS 파일: 1,690개                                      │
│  ├─ 그룹화됨: 973개 (57.6%)                            │
│  └─ 미그룹화: 717개 (42.4%)                            │
│                                                         │
│  NAS 그룹: 716개                                        │
│  ├─ PokerGO 매칭: 409개 (57.1%) ✅                     │
│  └─ PokerGO 미매칭: 307개 (42.9%) ← 모두 Historic     │
│                                                         │
│  PokerGO: 1,095개                                       │
│  ├─ NAS 매칭: 253개 (23.1%)                            │
│  └─ NAS 없음: 842개 (76.9%) ← 수집 필요 확인          │
└─────────────────────────────────────────────────────────┘
```

### 핵심 발견

| 발견 | 의미 |
|------|------|
| **미매칭 307개 = 모두 Historic (2011년 이전)** | PokerGO에 해당 데이터 없음 |
| **Modern (2011+) 미매칭 = 0개** | 현대 콘텐츠는 100% 매칭됨 |
| **PokerGO는 2019~2025만 존재** | 2018년 이전 WSOP는 PokerGO에 없음 |

---

## 4단계 실행 계획

### Phase 1: 원본-아카이브 검증 (목표 1)

**목적**: NAS Origin에서 누락된 파일이 Archive에 있는지 확인

#### 작업 목록

| # | 작업 | 설명 | 예상 |
|---|------|------|------|
| 1.1 | Origin/Archive 경로 정의 | NasFile에 source_type 필드 확인 | 30분 |
| 1.2 | 동기화 상태 분석 쿼리 | Origin Only, Archive Only, Both 분류 | 1시간 |
| 1.3 | 대시보드 위젯 추가 | 동기화 상태 표시 | 2시간 |
| 1.4 | 내보내기 컬럼 추가 | sync_status 컬럼 | 30분 |

#### 산출물

```
[Dashboard]
┌─────────────────────────────────────┐
│ Origin/Archive Sync Status          │
├─────────────────────────────────────┤
│ Both:         1,200 (71%)           │
│ Origin Only:    150 (9%)  ⚠️        │
│ Archive Only:   340 (20%)           │
└─────────────────────────────────────┘
```

---

### Phase 2: 양방향 매칭 검증 (목표 2)

**목적**: NAS ↔ PokerGO 양방향 매칭 완전성 검증

#### 작업 목록

| # | 작업 | 설명 | 예상 |
|---|------|------|------|
| 2.1 | 매칭 결과 4분류 구현 | 완전매칭, NAS Only, PokerGO Only, Gap | 1시간 |
| 2.2 | 내보내기 통합 완료 | NAS + Unmatched PokerGO 단일 시트 | ✅ 완료 |
| 2.3 | 매칭 상태 필드 추가 | match_category 컬럼 | 30분 |
| 2.4 | 대시보드 매칭 현황 | 4분류 통계 위젯 | 1시간 |

#### 매칭 분류 정의

| 분류 | NAS | PokerGO | 건수 | 조치 |
|------|-----|---------|------|------|
| `MATCHED` | 있음 | 매칭됨 | 409 | 완료 |
| `NAS_ONLY_HISTORIC` | 있음 | 없음 (2011 이전) | 307 | 카탈로그 자체 생성 |
| `NAS_ONLY_MODERN` | 있음 | 없음 (2011 이후) | 0 | 매칭 규칙 개선 |
| `POKERGO_ONLY` | 없음 | 있음 | 842 | 수집 필요 확인 |

---

### Phase 3: 매칭 실패 원인 분석 (목표 3)

**목적**: 307개 미매칭의 원인 분류 및 해결

#### 핵심 발견

```
┌─────────────────────────────────────────────────────────┐
│  307개 미매칭 분석 결과                                  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  원인: D01 (PokerGO에 데이터 없음) = 307개 (100%)       │
│                                                         │
│  상세:                                                  │
│  - 1973-2010 Historic WSOP 영상                        │
│  - PokerGO는 2019년 이후 WSOP만 보유                   │
│  - 규칙 수정으로 해결 불가 (데이터 자체가 없음)         │
│                                                         │
│  결론: 목표 4 (카탈로그 자체 생성)로 해결               │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 작업 목록

| # | 작업 | 설명 | 예상 |
|---|------|------|------|
| 3.1 | 원인 코드 자동 분류 | D01~D02, P01~P04, M01~M02 | 1시간 |
| 3.2 | 미매칭 상세 리포트 | 연도별, 원인별 통계 | 1시간 |
| 3.3 | PokerGO Only 분석 | 842개 중 수집 필요한 것 분류 | 2시간 |

#### 원인 코드 결과 (예상)

| 코드 | 원인 | 건수 | 해결 |
|------|------|------|------|
| `D01` | PokerGO에 데이터 없음 (Historic) | 307 | 카탈로그 자체 생성 |
| `D02` | NAS에 데이터 없음 (PokerGO Only) | 842 | 수집 여부 결정 |

---

### Phase 4: 카탈로그/제목 설계 (목표 4)

**목적**: 307개 Historic 콘텐츠의 표준 카탈로그/제목 생성

#### 4.1 카탈로그 구조 설계

```
[Historic 콘텐츠 카탈로그 구조]

Collection: "WSOP Historic (1973-2010)"
├── Season: "WSOP 1973"
│   └── Episode: "Main Event"
├── Season: "WSOP 1978"
│   └── Episode: "Main Event"
├── Season: "WSOP 2003"
│   ├── Episode: "Main Event Episode 1"
│   ├── Episode: "Main Event Episode 2"
│   ├── Episode: "Best Of All-Ins"
│   └── Episode: "Best Of Bluffs"
...
```

#### 4.2 제목 생성 규칙

| 콘텐츠 타입 | NAS Group ID | 생성 제목 |
|-------------|--------------|-----------|
| Historic ME (단일) | `1973_ME` | `WSOP 1973 Main Event` |
| Historic ME (에피소드) | `2003_ME_01` | `WSOP 2003 Main Event \| Episode 1` |
| Best Of | `2003_BEST-ALLINS` | `WSOP 2003 Best Of All-Ins` |
| Final Table | `2003_FT` | `WSOP 2003 Final Table` |
| Europe | `2008_EU_01` | `WSOP Europe 2008 \| Episode 1` |
| APAC | `2013_APAC-ME_01` | `WSOP APAC 2013 Main Event \| Show 1` |

#### 4.3 작업 목록

| # | 작업 | 설명 | 예상 |
|---|------|------|------|
| 4.1 | 제목 생성 함수 구현 | `generate_catalog_title(group)` | 2시간 |
| 4.2 | AssetGroup에 catalog_title 필드 추가 | DB 스키마 수정 | 30분 |
| 4.3 | 307개 그룹에 제목 일괄 생성 | 마이그레이션 스크립트 | 1시간 |
| 4.4 | 내보내기에 catalog_title 추가 | 시트 컬럼 추가 | 30분 |
| 4.5 | UI에서 제목 편집 기능 | 수동 오버라이드 | 2시간 |

#### 4.4 산출물

```
[내보내기 시트 - 최종 형태]

| Group ID | Year | Catalog Title | PokerGO Matched | PokerGO Title |
|----------|------|---------------|-----------------|---------------|
| 2011_ME_25 | 2011 | WSOP 2011 ME Ep25 | Yes | WSOP 2011... |
| 1973_ME | 1973 | WSOP 1973 Main Event | No (Historic) | - |
| 2003_BEST-ALLINS | 2003 | WSOP 2003 Best Of... | No (Historic) | - |
```

---

## 전체 일정 요약

```
Phase 1: 원본-아카이브 검증
├── 1.1~1.4: 4시간
│
Phase 2: 양방향 매칭 검증
├── 2.1, 2.3~2.4: 2.5시간 (2.2 완료)
│
Phase 3: 매칭 실패 원인 분석
├── 3.1~3.3: 4시간
│
Phase 4: 카탈로그/제목 설계
├── 4.1~4.5: 6시간
│
총 예상: 16.5시간
```

---

## 우선순위 제안

```
[권장 실행 순서]

1순위: Phase 4 (카탈로그/제목)  ← 핵심 목표
       307개 Historic 콘텐츠 제목 생성

2순위: Phase 2 (양방향 매칭)
       매칭 분류 4가지로 명확화

3순위: Phase 3 (원인 분석)
       842개 PokerGO Only 분석

4순위: Phase 1 (Origin/Archive)
       동기화 상태 검증
```

---

## 성공 기준

| 목표 | 현재 | 목표 | 측정 방법 |
|------|------|------|-----------|
| NAS 그룹 카탈로그 제목 | 0% | 100% | `catalog_title IS NOT NULL` |
| 매칭 분류 명확화 | 2분류 | 4분류 | match_category 필드 |
| PokerGO Only 분류 | 미분류 | 분류완료 | 수집필요/불필요 태그 |
| Origin/Archive 동기화 | 미확인 | 확인완료 | sync_status 필드 |

---

## 다음 단계

**즉시 실행**: Phase 4.1 - 제목 생성 함수 구현

```python
def generate_catalog_title(group: AssetGroup) -> str:
    """NAS 그룹에서 카탈로그 제목 생성"""
    # 구현 예정
```
