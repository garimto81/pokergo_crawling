# NAMS Project Plan

> NAS Asset Management System - WSOP 52년 역사 카테고리 구축

**Version**: 4.0 | **Updated**: 2025-12-17

---

## 프로젝트 목표

### 핵심 인사이트

```
┌─────────────────────────────────────────────────────────────────┐
│                    데이터 관계: 부분 매칭 (복잡함)                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [PokerGO 828개]              [NAS 858개 Active]                │
│  ├─ 완성된 카테고리            ├─ 일부: PokerGO 매칭 가능        │
│  ├─ 완성된 제목                └─ 일부: PokerGO 매칭 불가        │
│  └─ 편집된 에피소드                                              │
│                                                                 │
│  → 전부 매칭되는 것도 아님                                       │
│  → 전부 매칭 안 되는 것도 아님                                   │
│  → 개별 검사 + 매칭 작업 필요                                    │
│                                                                 │
│  PokerGO의 가치:                                                 │
│  └─ 카테고리/제목이 가장 완성도 높음 → 최대한 활용               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 하이브리드 접근

```
NAS 파일 858개
    │
    ├─[매칭 가능]──▶ PokerGO 카테고리/제목 활용 (완성된 메타데이터)
    │
    └─[매칭 불가]──▶ 자체 카테고리/제목 생성 (패턴 기반)
```

---

## 현재 상태 (2025-12-17)

### 보유 자산

| 항목 | 수량 | 비고 |
|------|------|------|
| NAS 전체 파일 | 1,405 | X: + Y: + Z: |
| Active 파일 | 858 | 제외 조건 미해당 |
| Excluded 파일 | 547 | 클립, 짧은 영상 등 |
| PokerGO 에피소드 | 828 | 완성된 카테고리/제목 |

### 드라이브별 현황

| 드라이브 | 용도 | 파일 수 | 크기 |
|----------|------|---------|------|
| X: | PokerGO Source | 247 | 684 GB |
| Y: | WSOP Backup | 371 | 1.8 TB |
| Z: | Archive (Primary) | 1,405 | 20 TB |

---

## 새로운 데이터 모델

### 핵심 개념

```
Category (카테고리)
└── CategoryEntry (카테고리 항목)
    ├── NasFile[] (NAS 파일 - 1:N)
    └── pokergo_ep_id (PokerGO 참조 - 있으면)
```

### 테이블 구조

| 테이블 | 역할 |
|--------|------|
| **Category** | 연도별 시리즈 (WSOP 2022, WSOP Europe 2022, ...) |
| **CategoryEntry** | 개별 콘텐츠 (Main Event Day 1, Bracelet #1, ...) |
| **NasFile** | 실제 파일 (file_id 기반 식별) |

### 파일 식별 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                    파일 경로 변경 대응                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [핵심 원칙]                                                    │
│  ├─ 파일명 = 불변 (고유 식별자, file_id)                        │
│  └─ 파일 경로 = 가변 (업데이트 가능)                            │
│                                                                 │
│  [경로 변경 시]                                                  │
│  ├─ file_id (파일명) → 유지                                     │
│  ├─ entry_id (카테고리 연결) → 유지                             │
│  ├─ 매칭 정보 → 유지                                            │
│  └─ file_path → 업데이트                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 매칭 유형

| match_type | 설명 | 제목 출처 |
|------------|------|----------|
| **EXACT** | PokerGO 1:1 매칭 | PokerGO 제목 |
| **PARTIAL** | 부분 매칭 (검증 필요) | PokerGO 제목 + 확인 |
| **MANUAL** | 수동 지정 | 수동 입력 |
| **NONE** | 매칭 불가 | 자체 생성 |

### 상세 설계

→ [docs/PRD-CATALOG-DB.md](../../docs/PRD-CATALOG-DB.md)

---

## KPI

### 목표 지표

| 지표 | 정의 | 목표 |
|------|------|------|
| **카테고리 커버리지** | Entry 연결된 NasFile / Active NasFile | 95%+ |
| **제목 완성도** | display_title 있는 Entry / 전체 Entry | 100% |
| **PokerGO 활용률** | source='POKERGO' Entry / 전체 Entry | 60%+ |
| **검증 완료율** | verified=true Entry / 전체 Entry | 80%+ |

### 매칭 분포 목표

| 매칭 유형 | 예상 비율 |
|----------|----------|
| EXACT | 40% |
| PARTIAL | 15% |
| MANUAL | 5% |
| NONE | 40% |

---

## 실행 로드맵 (5주)

### Phase 1: DB 마이그레이션 (Week 1)

**목표**: 새 스키마로 전환

| Task | 설명 |
|------|------|
| 새 테이블 생성 | categories, category_entries |
| NasFile 스키마 수정 | entry_id 컬럼 추가 |
| 데이터 마이그레이션 | AssetGroup → CategoryEntry 변환 |
| 기존 테이블 백업 | asset_groups 등 보존 |

```python
python scripts/migrate_to_category.py
```

### Phase 2: 매칭 엔진 개선 (Week 2)

**목표**: 하이브리드 매칭 구현

| Task | 설명 |
|------|------|
| EXACT 매칭 로직 | PokerGO 1:1 매칭 |
| PARTIAL 매칭 로직 | 부분 매칭 + 검증 플래그 |
| NONE 처리 | 자체 카테고리/제목 생성 |
| 매칭 결과 저장 | match_type, source 기록 |

```python
python scripts/run_hybrid_matching.py
```

### Phase 3: AI 추론 기반 제목 생성 (Week 3)

**목표**: 모든 Entry에 display_title (AI 활용)

| Task | 설명 |
|------|------|
| PokerGO 제목 복사 | EXACT/PARTIAL → PokerGO 제목 그대로 |
| **AI 추론 제목 생성** | NONE → AI가 카테고리/제목 추론 |
| PokerGO 컨텍스트 제공 | 828개 메타데이터를 참조 정보로 활용 |
| Fallback 처리 | AI 실패 시 패턴 기반 대체 |

#### AI 추론 방식

```
┌──────────────────────────────────────────────────────────────┐
│                    AI 추론 컨텍스트                           │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Input:                                                      │
│  ├─ NAS 파일명: "MPP_Cyprus_2025_Day3_FT.mp4"               │
│  ├─ NAS 경로: "Z:\WSOP\Cyprus\2025\"                        │
│  └─ PokerGO 참조: 828개 에피소드 메타데이터 (컨텍스트)       │
│                                                              │
│  Output:                                                     │
│  ├─ 카테고리: "WSOP Cyprus 2025"                            │
│  └─ 제목: "WSOP Cyprus 2025 Day 3 Final Table"              │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 비용 최적화

| 전략 | 설명 |
|------|------|
| Batch 처리 | 여러 파일 한 번에 |
| 캐싱 | 동일 패턴 재사용 |
| **Gemini Flash** | 저비용 추론 (Google AI) |

### Phase 4: UI 및 검증 워크플로우 (Week 4)

**목표**: 수동 검증 가능한 UI 구축

| Task | 설명 |
|------|------|
| 대시보드 수정 | 신규 KPI 표시 |
| 카테고리 목록 | 필터, 정렬, 인라인 편집 |
| 검증 워크플로우 | 일괄 검증, 검증 이력 |
| 매칭 후보 UI | PARTIAL 항목 수동 확인 |

### Phase 5: 내보내기 및 완성 (Week 5)

**목표**: 최종 카테고리 내보내기

| Task | 설명 |
|------|------|
| Google Sheets 수정 | 신규 스키마 반영 |
| 카테고리 시트 추가 | Category/Entry 전용 시트 |
| 최종 검증 | 데이터 품질 검토 |
| 문서 업데이트 | 완료 보고서 |

---

## 핵심 원칙

### 1. PokerGO 우선

- PokerGO 카테고리/제목이 가장 완성도 높음
- 매칭 가능하면 PokerGO 데이터 최대 활용

### 2. 자체 생성 보완

- 매칭 불가 시 패턴 기반 자체 생성
- Paradise, Cyprus, APAC 등 PokerGO 범위 밖

### 3. 개별 검증

- 모든 매칭 결과 수동 검증
- PARTIAL은 반드시 확인 필요

### 4. 하이브리드 접근

- 자동: 패턴 기반 매칭/생성 (90%)
- 수동: 검증, 예외 처리 (10%)

---

## 성공 정의

### Week 5 완료 시점

| 지표 | 목표 |
|------|------|
| 카테고리 항목 | 800+ entries |
| 카테고리 커버리지 | 95%+ |
| 제목 완성도 | 100% |
| PokerGO 활용률 | 60%+ |
| 검증 완료율 | 80%+ |

### 산출물

- [ ] SQLite DB (신규 스키마)
- [ ] 하이브리드 매칭 엔진
- [ ] 제목 생성 엔진
- [ ] 검증 UI
- [ ] Google Sheets 내보내기

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 4.0 | 2025-12-17 | **하이브리드 접근**: PokerGO 우선 + 자체 생성 보완, 카탈로그→카테고리 |
| 3.0 | 2025-12-17 | 패러다임 전환: NAS 중심 카탈로그 |
| 2.0 | 2025-12-17 | 현실적 목표 재설정 (80%→65%) |
| 1.0 | 2025-12-17 | 초기 계획 수립 |
